import{x as P,U as o,_ as g,aM as A,aN as E,aI as c,aG as O}from"./index-7963d4d4.js";import{e as R}from"./LabelClass-3855bc1c.js";import{p as x}from"./jsonUtils-55a27fb8.js";import{A as j}from"./UniqueValueRenderer-d9c6adaa.js";import{c as L}from"./AttachmentQuery-f2e0d44e.js";import{b as l}from"./Query-9b208b7c.js";import I from"./RelationshipQuery-6ab43a24.js";const T=new P({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function D(e,t,n,r){const a=await i(e);if(await m(e,t,r),!a.addAttachment)throw new o(r,"Layer source does not support addAttachment capability");return a.addAttachment(t,n)}function m(e,t,n){const{attributes:r}=t,{objectIdField:a}=e;return e.get("capabilities.data.supportsAttachment")?t?r?a&&r[a]?Promise.resolve():Promise.reject(new o(n,`feature is missing the identifying attribute ${a}`)):Promise.reject(new o(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new o(n,"A feature is required to add/delete/update attachments")):Promise.reject(new o(n,"this layer doesn't support attachments"))}async function Q(e,t,n,r,a){const s=await i(e);if(await m(e,t,a),!s.updateAttachment)throw new o(a,"Layer source does not support updateAttachment capability");return s.updateAttachment(t,n,r)}async function N(e,t,n){const{applyEdits:r}=await g(()=>import("./editingSupport-2719243a.js"),["assets/editingSupport-2719243a.js","assets/index-7963d4d4.js","assets/index-530e9757.css","assets/normalizeUtils-177a2192.js","assets/normalizeUtilsCommon-062a2641.js","assets/FeatureLayerBase-0e1c856a.js","assets/Field-d77a8215.js","assets/fieldType-673942bd.js","assets/commonProperties-6814a39e.js","assets/ElevationInfo-ee94dcc6.js","assets/lengthUtils-3299f41f.js","assets/serviceCapabilitiesUtils-ea9bb8d4.js","assets/LabelClass-3855bc1c.js","assets/labelUtils-29518584.js","assets/defaultsJSON-b087dd4d.js","assets/featureFlags-170ded2f.js","assets/jsonUtils-55a27fb8.js","assets/UniqueValueRenderer-d9c6adaa.js","assets/LegendOptions-abb39b11.js","assets/diffUtils-c3909250.js","assets/SizeVariable-30352570.js","assets/colorRamps-4a2c033a.js","assets/ColorStop-9a1877a7.js","assets/styleUtils-90aa8275.js","assets/DictionaryLoader-3032dcef.js","assets/LRUCache-50962364.js","assets/FieldsIndex-86e1c691.js","assets/heatmapUtils-c2534201.js","assets/vec4f64-aa64c7e9.js","assets/AttachmentQuery-f2e0d44e.js","assets/Query-9b208b7c.js","assets/RelationshipQuery-6ab43a24.js"]),a=await e.load();return r(a,a.source,t,n)}async function Z(e,t,n){const{uploadAssets:r}=await g(()=>import("./editingSupport-2719243a.js"),["assets/editingSupport-2719243a.js","assets/index-7963d4d4.js","assets/index-530e9757.css","assets/normalizeUtils-177a2192.js","assets/normalizeUtilsCommon-062a2641.js","assets/FeatureLayerBase-0e1c856a.js","assets/Field-d77a8215.js","assets/fieldType-673942bd.js","assets/commonProperties-6814a39e.js","assets/ElevationInfo-ee94dcc6.js","assets/lengthUtils-3299f41f.js","assets/serviceCapabilitiesUtils-ea9bb8d4.js","assets/LabelClass-3855bc1c.js","assets/labelUtils-29518584.js","assets/defaultsJSON-b087dd4d.js","assets/featureFlags-170ded2f.js","assets/jsonUtils-55a27fb8.js","assets/UniqueValueRenderer-d9c6adaa.js","assets/LegendOptions-abb39b11.js","assets/diffUtils-c3909250.js","assets/SizeVariable-30352570.js","assets/colorRamps-4a2c033a.js","assets/ColorStop-9a1877a7.js","assets/styleUtils-90aa8275.js","assets/DictionaryLoader-3032dcef.js","assets/LRUCache-50962364.js","assets/FieldsIndex-86e1c691.js","assets/heatmapUtils-c2534201.js","assets/vec4f64-aa64c7e9.js","assets/AttachmentQuery-f2e0d44e.js","assets/Query-9b208b7c.js","assets/RelationshipQuery-6ab43a24.js"]),a=await e.load();return r(a,a.source,t,n)}async function H(e,t,n,r){const a=await i(e);if(await m(e,t,r),!a.deleteAttachments)throw new o(r,"Layer source does not support deleteAttachments capability");return a.deleteAttachments(t,n)}async function J(e,t,n){const r=(await e.load({signal:t==null?void 0:t.signal})).source;if(!r.fetchRecomputedExtents)throw new o(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(t)}async function k(e,t,n,r){var w,b;t=L.from(t),await e.load();const a=e.source,s=e.capabilities;if(!((w=s==null?void 0:s.data)!=null&&w.supportsAttachment))throw new o(r,"this layer doesn't support attachments");const{attachmentTypes:p,objectIds:d,globalIds:u,num:q,size:y,start:F,where:h}=t;if(!((b=s==null?void 0:s.operations)!=null&&b.supportsQueryAttachments)&&((p==null?void 0:p.length)>0||(u==null?void 0:u.length)>0||(y==null?void 0:y.length)>0||q||F||h))throw new o(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",t);if(!(d!=null&&d.length||u!=null&&u.length||h))throw new o(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",t);if(!a.queryAttachments)throw new o(r,"Layer source does not support queryAttachments capability",t);return a.queryAttachments(t)}async function z(e,t,n,r){const a=await i(e);if(!a.queryObjectIds)throw new o(r,"Layer source does not support queryObjectIds capability");return a.queryObjectIds(l.from(t)??e.createQuery(),n)}async function B(e,t,n,r){const a=await i(e);if(!a.queryFeatureCount)throw new o(r,"Layer source does not support queryFeatureCount capability");return a.queryFeatureCount(l.from(t)??e.createQuery(),n)}async function K(e,t,n,r){const a=await i(e);if(!a.queryExtent)throw new o(r,"Layer source does not support queryExtent capability");return a.queryExtent(l.from(t)??e.createQuery(),n)}async function W(e,t,n,r){const a=await i(e);if(!a.queryRelatedFeatures)throw new o(r,"Layer source does not support queryRelatedFeatures capability");return a.queryRelatedFeatures(I.from(t),n)}async function X(e,t,n,r){const a=await i(e);if(!a.queryRelatedFeaturesCount)throw new o(r,"Layer source does not support queryRelatedFeaturesCount capability");return a.queryRelatedFeaturesCount(I.from(t),n)}async function Y(e){const t=e.source;if(t!=null&&t.refresh)try{const{dataChanged:n,updates:r}=await t.refresh();if(r!=null&&(e.sourceJSON={...e.sourceJSON,...r},e.read(r,{origin:"service",url:e.parsedUrl})),n)return!0}catch{}if(e.definitionExpression)try{return(await R(e.definitionExpression,e.fieldsIndex)).hasDateFunctions}catch{}return!1}function ee(e){const t=new l,n=e.get("capabilities.data"),r=e.get("capabilities.query");t.historicMoment=e.historicMoment,t.gdbVersion=e.gdbVersion,t.returnGeometry=!0,r&&(t.compactGeometryEnabled=r.supportsCompactGeometry,t.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&e.returnZ!=null&&(t.returnZ=e.returnZ),n.supportsM&&e.returnM!=null&&(t.returnM=e.returnM)),t.outFields=["*"];const{timeOffset:a,timeExtent:s}=e;return t.timeExtent=a!=null&&s!=null?s.offset(-a.value,a.unit):s||null,t.multipatchOption=e.geometryType==="multipatch"?"xyFootprint":null,t}function te(e){const{globalIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function re(e){const{objectIdField:t,fields:n}=e;if(t)return t;if(n){for(const r of n)if(r.type==="esriFieldTypeOID")return r.name}}function ne(e){return e.currentVersion?e.currentVersion:e.hasOwnProperty("capabilities")||e.hasOwnProperty("drawingInfo")||e.hasOwnProperty("hasAttachments")||e.hasOwnProperty("htmlPopupType")||e.hasOwnProperty("relationships")||e.hasOwnProperty("timeInfo")||e.hasOwnProperty("typeIdField")||e.hasOwnProperty("types")?10:9.3}async function i(e){return(await e.load()).source}async function S(e,t){if(!c||c.findCredential(e))return;let n;try{const r=await O(e,t);r&&(n=await c.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{const r=t!=null?t.signal:null;await c.getCredential(e,{signal:r})}catch{}}async function ae(e,t){var r;const n=(r=e.parsedUrl)==null?void 0:r.path;n&&_(e)&&await S(n,t)}function _(e){const t=e.editFieldsInfo;return!(!(t!=null&&t.creatorField)&&!(t!=null&&t.editorField))||(e.userHasUpdateItemPrivileges?e.hasUpdateItemRestrictions:!!e.userHasFullEditingPrivileges&&e.hasFullEditingRestrictions)}function oe(e){var t;return!((t=e.sourceJSON)!=null&&t.isMultiServicesView)&&(e.userHasUpdateItemPrivileges||e.editingEnabled)}const f=A({types:E});function se(e,t){if(e.defaultSymbol)return e.types&&e.types.length?new j({defaultSymbol:f(e.defaultSymbol,e,t),field:e.typeIdField,uniqueValueInfos:e.types.map(n=>({id:n.id,symbol:f(n.symbol,n,t)}))}):new x({symbol:f(e.defaultSymbol,e,t)})}export{X as A,ee as E,B as F,K as I,ae as M,Y as O,W as P,oe as Q,re as R,te as S,H as b,T as d,J as g,N as h,k as j,Q as m,z as q,se as v,Z as w,ne as x,D as y};
